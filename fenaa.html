<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Tuna Galeri | Underground</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #game-ui { position: fixed; width: 320px; height: 100vh; background: rgba(10,10,10,0.95); border-right: 2px solid #333; z-index: 100; padding: 20px; box-sizing: border-box; }
        #viewport { margin-left: 320px; width: calc(100vw - 320px); height: 100vh; position: relative; }
        
        .stat-card { background: #1a1a1a; padding: 10px; border-radius: 8px; border-left: 4px solid #00f2ff; margin-bottom: 10px; }
        .btn { background: #333; color: #fff; border: none; padding: 12px; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 10px; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #00f2ff; color: #000; }
        
        #phone { position: absolute; bottom: 20px; right: 20px; width: 200px; height: 350px; background: #111; border: 4px solid #444; border-radius: 20px; padding: 15px; display: none; z-index: 1000; box-shadow: 0 0 30px rgba(0,0,0,1); }
        #speedo { position: absolute; bottom: 30px; left: 30px; font-size: 45px; color: #00f2ff; font-family: monospace; text-shadow: 0 0 10px #00f2ff; }
        
        .npc-dialog { background: #222; padding: 10px; border-radius: 5px; font-size: 13px; border: 1px solid #444; margin-top: 20px; display: none; }
        @keyframes ring { 0% { transform: scale(1); } 50% { transform: scale(1.05); border-color: #ff007f; } 100% { transform: scale(1); } }
        .ringing { animation: ring 0.5s infinite; border-color: #ff007f !important; display: block !important; }
    </style>
</head>
<body>

<div id="game-ui">
    <h2 style="color:#00f2ff; text-align:center;">TUNA GALERÄ°</h2>
    
    <div class="stat-card">ğŸ’° PARA: <span id="m-val">500.000</span>â‚º</div>
    <div class="stat-card">ğŸ” AÃ‡LIK: %<span id="h-val">100</span></div>
    <div class="stat-card">ğŸ•Œ Ä°MAN: %<span id="f-val">100</span></div>
    <hr color="#333">
    
    <button class="btn" onclick="interact('galeri')">ğŸ¢ GALERÄ°YE GÄ°T</button>
    <button class="btn" onclick="interact('sanayi')">ğŸ”§ SANAYÄ°YE GÄ°T</button>
    <button class="btn" onclick="interact('cami')">ğŸ•Œ CAMÄ°YE GÄ°T</button>
    <button class="btn" onclick="interact('tefeci')" style="border: 1px solid red;">ğŸ•¶ï¸ TEFECÄ° HAYRÄ°</button>

    <div id="npc-box" class="npc-dialog">
        <b id="npc-name" style="color:#00f2ff"></b>
        <p id="npc-text"></p>
        <div id="npc-btns"></div>
    </div>
</div>

<div id="viewport">
    <div id="speedo">0 KM/H</div>
    <div id="phone">
        <div style="text-align:center; font-size:12px; color:#666;">IPHONE 16 PRO</div>
        <div id="phone-content" style="margin-top:50px; text-align:center;">
            <p id="caller">Arama Yok</p>
            <button class="btn" onclick="answer()">CEVAPLA (T)</button>
        </div>
    </div>
    <canvas id="stage"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    let state = { money: 500000, hunger: 100, faith: 100, car: null, speed: 0 };
    
    // --- NPC SÄ°STEMÄ° ---
    function interact(loc) {
        const box = document.getElementById('npc-box');
        const name = document.getElementById('npc-name');
        const text = document.getElementById('npc-text');
        const btns = document.getElementById('npc-btns');
        box.style.display = "block"; btns.innerHTML = "";

        if(loc === 'galeri') {
            name.innerText = "Galerici Metin";
            text.innerText = "Elimde bi' tane efsane Supra var. 4M istiyorlar. AlÄ±r mÄ±sÄ±n?";
            btns.innerHTML = `<button class="btn" onclick="buyCar('Supra', 4000000, 0xffaa00)">4M â‚º SATIN AL</button>`;
        } else if(loc === 'sanayi') {
            name.innerText = "Sabri Usta";
            text.innerText = "ArabanÄ±n rengini mi beÄŸenmedin? 50k'ya boyarÄ±z.";
            btns.innerHTML = `<button class="btn" onclick="modCar()">50k â‚º BOYA</button>`;
        } else if(loc === 'tefeci') {
            name.innerText = "Tefeci Hayri";
            text.innerText = "YeÄŸen, sÄ±kÄ±ÅŸÄ±ksan 200k vereyim ama haftaya 400k alÄ±rÄ±m.";
            btns.innerHTML = `<button class="btn" onclick="getDebt()">200k BORÃ‡ AL</button>`;
        } else if(loc === 'cami') {
            state.faith = 100; state.hunger = Math.max(0, state.hunger-10); updateUI();
            alert("Namaz kÄ±lÄ±ndÄ±, huzur doldu.");
        }
    }

    function buyCar(n, p, c) {
        if(state.money >= p) { state.money -= p; state.car = {n, c}; updateUI(); createCar(); alert(n + " garajda!"); }
        else alert("Para yetmiyor kral.");
    }

    function modCar() {
        if(state.car && state.money >= 50000) { state.money -= 50000; state.car.c = Math.random() * 0xffffff; createCar(); updateUI(); }
    }

    function getDebt() { state.money += 200000; updateUI(); alert("BorÃ§ alÄ±ndÄ±, Hayri ensende!"); }

    function updateUI() {
        document.getElementById('m-val').innerText = state.money.toLocaleString();
        document.getElementById('h-val').innerText = Math.floor(state.hunger);
        document.getElementById('f-val').innerText = state.faith;
    }

    // --- 3D SÃœRÃœÅ (TEK PARÃ‡A AKICI) ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, (window.innerWidth-320)/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('stage'), antialias: true });
    renderer.setSize(window.innerWidth - 320, window.innerHeight);

    // Yol ve Åehir Ã‡izgileri
    const grid = new THREE.GridHelper(2000, 100, 0x444444, 0x222222);
    scene.add(grid);
    scene.add(new THREE.AmbientLight(0xffffff, 0.5));

    const player = new THREE.Group();
    scene.add(player);

    function createCar() {
        player.clear();
        let color = state.car ? state.car.c : 0x555555;
        let body = new THREE.Mesh(new THREE.BoxGeometry(2, 0.8, 4), new THREE.MeshStandardMaterial({color}));
        body.position.y = 0.5;
        player.add(body);
        let headL = new THREE.PointLight(0xffffff, 2, 10); headL.position.set(0,1,-2); player.add(headL);
    }
    createCar();

    let keys = {};
    window.onkeydown = (e) => { keys[e.key.toLowerCase()] = true; if(e.key === 't') answer(); };
    window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

    let rot = 0;
    function drive() {
        requestAnimationFrame(drive);
        
        let targetS = keys['w'] ? 1.2 : (keys['s'] ? -0.4 : 0);
        state.speed = THREE.MathUtils.lerp(state.speed, targetS, 0.05);
        
        if(keys['a']) rot += 0.03;
        if(keys['d']) rot -= 0.03;

        player.rotation.y = rot;
        player.translateZ(-state.speed);

        // Kamera Takibi
        let offset = new THREE.Vector3(0, 7, 13).applyMatrix4(player.matrixWorld);
        camera.position.lerp(offset, 0.1);
        camera.lookAt(player.position);

        // AÃ§lÄ±k
        state.hunger = Math.max(0, state.hunger - 0.005);
        
        document.getElementById('speedo').innerText = Math.abs(Math.floor(state.speed * 180)) + " KM/H";
        updateUI();
        renderer.render(scene, camera);
    }

    // --- TELEFON ---
    function ring() {
        const ph = document.getElementById('phone');
        document.getElementById('caller').innerText = "Tefeci Hayri ArÄ±yor...";
        ph.style.display = "block";
        ph.classList.add('ringing');
    }
    function answer() {
        const ph = document.getElementById('phone');
        ph.classList.remove('ringing');
        ph.style.display = "none";
        alert("Hayri: Borcun faizi bindi yeÄŸen, akÅŸam uÄŸrayacaÄŸÄ±m!");
    }

    setInterval(() => { if(Math.random() > 0.7) ring(); }, 20000);
    drive();
</script>
</body>
</html>
