<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Tuna Galeri: Mafia City Pro</title>
    <style>
        :root { --neon: #00f2ff; --pink: #ff007f; --gold: #ffd700; --red: #ff4757; }
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* HUD UI */
        .hud { position: fixed; top: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; z-index: 100; pointer-events: none; }
        .stat-card { background: rgba(0,0,0,0.85); border: 1px solid var(--neon); padding: 10px 15px; border-radius: 5px; pointer-events: all; margin-bottom: 5px; }

        /* Main Screen Layout */
        .main-ui { display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
        .side-menu { background: #0a0a0a; border-right: 2px solid #222; padding: 20px; z-index: 10; display: flex; flex-direction: column; }
        .world-container { position: relative; }

        /* Phone UI */
        #phone { position: fixed; bottom: -380px; right: 30px; width: 220px; height: 400px; background: #111; border: 4px solid #333; border-radius: 30px; transition: 0.5s; z-index: 500; padding: 20px; box-sizing: border-box; }
        #phone.active { bottom: 20px; border-color: var(--pink); box-shadow: 0 0 20px var(--pink); }
        .contact { background: #1a1a1a; padding: 8px; margin-bottom: 5px; border-radius: 5px; cursor: pointer; font-size: 13px; border: 1px solid #333; }
        .contact:hover { border-color: var(--neon); }

        /* Action Modal */
        #action-modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #0a0a0a; border: 2px solid var(--gold); padding: 30px; border-radius: 20px; display: none; z-index: 1000; min-width: 250px; text-align: center; }
        .btn { background: #222; border: 1px solid var(--neon); color: #fff; padding: 12px; margin: 5px 0; width: 100%; cursor: pointer; border-radius: 8px; font-weight: bold; }
        .btn:hover { background: var(--neon); color: #000; }

        canvas { width: 100%; height: 100%; }
        #speedo { position: absolute; bottom: 30px; left: 30px; font-size: 40px; color: var(--neon); font-family: 'Courier New', Courier, monospace; }
    </style>
</head>
<body>

<div class="hud">
    <div>
        <div class="stat-card">üí∞ PARA: <span id="h-money">500.000</span>‚Ç∫</div>
        <div class="stat-card" style="border-color:var(--pink)">üçî TOKLUK: %<span id="h-hunger">100</span></div>
    </div>
    <div style="text-align: right;">
        <div class="stat-card" style="border-color:var(--gold)">üèõÔ∏è BOR√á: <span id="h-debt">0</span>‚Ç∫</div>
        <div class="stat-card" style="border-color:var(--red)">üî• STRES: %<span id="h-stress">0</span></div>
    </div>
</div>

<div class="main-ui">
    <div class="side-menu">
        <h2 style="color:var(--neon); border-bottom:1px solid #333; padding-bottom:10px;">MAFIA OS v1.0</h2>
        <div style="flex:1; overflow-y:auto;" id="npc-list">
            </div>
        <button class="btn" onclick="togglePhone()" style="border-color:var(--pink)">üì± TELEFONU A√á</button>
    </div>

    <div class="world-container">
        <div id="action-modal">
            <h3 id="modal-title">NPC ƒ∞SMƒ∞</h3>
            <p id="modal-desc">Konu≈üma i√ßeriƒüi...</p>
            <div id="modal-actions"></div>
            <button class="btn" style="border-color:var(--red); margin-top:15px;" onclick="closeModal()">KAPAT</button>
        </div>
        <div id="speedo">0 KM/H</div>
        <canvas id="game-canvas"></canvas>
    </div>
</div>

<div id="phone">
    <h4 style="margin:0 0 10px 0; color:var(--pink);">REHBER</h4>
    <div id="contacts-list"></div>
    <div id="incoming-call" style="display:none; margin-top:20px; text-align:center;">
        <p id="caller-id" style="font-weight:bold;"></p>
        <button class="btn" style="background:var(--neon); color:#000;" onclick="answerCall()">CEVAPLA (T)</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // --- OYUN AYARLARI ---
    let state = { money: 500000, hunger: 100, stress: 0, debt: 0, carColor: 0x00f2ff };
    const NPCs = [
        { name: "Tefeci Hayri", icon: "üï∂Ô∏è", job: "Para Kaynaƒüƒ±", msg: "Para biterse kapƒ±m a√ßƒ±k ama √∂demezsen bacaklarƒ±nƒ± alƒ±rƒ±m.", type: "loan" },
        { name: "Baron Ziya", icon: "üö¨", job: "Mafya Babasƒ±", msg: "≈ûehirde bir i≈ü yapƒ±lacaksa √∂nce benden izin alƒ±nacak.", type: "mafia" },
        { name: "Gurme Vedat", icon: "üç±", job: "Lokantacƒ±", msg: "A√ßlƒ±ktan √∂l√ºyorsun yeƒüen, gel bir ≈üeyler ye.", type: "food" },
        { name: "Galerici Metin", icon: "üèéÔ∏è", job: "Ara√ß Satƒ±≈ü", msg: "Liman altƒ±na yeni ara√ßlar indi, gel bak.", type: "trade" },
        { name: "Modifiyeci Sabri", icon: "üîß", job: "Tuning", msg: "Bu arabayƒ± basmazsak asfalt k√ºser.", type: "mod" }
    ];

    // --- UI FONKSƒ∞YONLARI ---
    const npcContainer = document.getElementById('npc-list');
    const contactsContainer = document.getElementById('contacts-list');

    NPCs.forEach(npc => {
        // Yan Men√º
        let div = document.createElement('div');
        div.style = "background:#111; padding:10px; margin-bottom:10px; border-radius:5px; cursor:pointer;";
        div.innerHTML = `<b style="color:var(--gold)">${npc.icon} ${npc.name}</b><br><small>${npc.job}</small>`;
        div.onclick = () => openModal(npc);
        npcContainer.appendChild(div);

        // Telefon Rehberi
        let contact = document.createElement('div');
        contact.className = "contact";
        contact.innerText = npc.name;
        contact.onclick = () => { alert(npc.name + " aranƒ±yor... ≈ûuan me≈ügul."); };
        contactsContainer.appendChild(contact);
    });

    function openModal(npc) {
        document.getElementById('action-modal').style.display = 'block';
        document.getElementById('modal-title').innerText = npc.name;
        document.getElementById('modal-desc').innerText = npc.msg;
        let area = document.getElementById('modal-actions');
        area.innerHTML = "";

        if(npc.type === "loan") createBtn(area, "100.000‚Ç∫ Bor√ß Al", () => { state.money += 100000; state.debt += 150000; updateUI(); });
        if(npc.type === "food") createBtn(area, "Ziyafet √áek (‚Ç∫5000)", () => { if(state.money>=5000){state.money-=5000; state.hunger=100; state.stress=0; updateUI();} });
        if(npc.type === "mod") createBtn(area, "Neon Rengi (‚Ç∫25k)", () => { if(state.money>=25000){state.money-=25000; state.carColor=Math.random()*0xffffff; createCar(); updateUI();} });
    }

    function createBtn(parent, text, action) {
        let b = document.createElement('button'); b.className = 'btn'; b.innerText = text; b.onclick = action; parent.appendChild(b);
    }
    function closeModal() { document.getElementById('action-modal').style.display = 'none'; }
    function togglePhone() { document.getElementById('phone').classList.toggle('active'); }
    function updateUI() {
        document.getElementById('h-money').innerText = state.money.toLocaleString();
        document.getElementById('h-hunger').innerText = Math.floor(state.hunger);
        document.getElementById('h-stress').innerText = Math.floor(state.stress);
        document.getElementById('h-debt').innerText = state.debt.toLocaleString();
    }

    // --- 3D ≈ûEHƒ∞R MOTORU ---
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x000000, 10, 150);
    const camera = new THREE.PerspectiveCamera(75, (window.innerWidth-320)/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('game-canvas'), antialias: true });
    renderer.setSize(window.innerWidth - 320, window.innerHeight);

    // Zemin ve Yol Izgarasƒ±
    const floor = new THREE.GridHelper(2000, 100, 0x333333, 0x111111);
    scene.add(floor);

    // ≈ûehir Binalarƒ± Olu≈üturma
    for(let i=0; i<80; i++) {
        let h = 10 + Math.random() * 40;
        let w = 5 + Math.random() * 10;
        let building = new THREE.Mesh(
            new THREE.BoxGeometry(w, h, w),
            new THREE.MeshStandardMaterial({color: 0x111111, wireframe: false})
        );
        building.position.set( (Math.random()-0.5)*400, h/2, (Math.random()-0.5)*400 );
        // Bina pencereleri (neon)
        let windows = new THREE.BoxHelper(building, Math.random() > 0.5 ? 0x00f2ff : 0xff007f);
        scene.add(building, windows);
    }

    // Oyuncu Arabasƒ±
    const player = new THREE.Group();
    scene.add(player);
    function createCar() {
        player.clear();
        let body = new THREE.Mesh(new THREE.BoxGeometry(2, 0.7, 4), new THREE.MeshStandardMaterial({color: state.carColor}));
        body.position.y = 0.5;
        let glass = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.4, 1.5), new THREE.MeshStandardMaterial({color: 0x000000}));
        glass.position.set(0, 0.9, 0.3);
        player.add(body, glass);
        let l1 = new THREE.PointLight(state.carColor, 2, 10); l1.position.set(0, 0, 0); player.add(l1);
    }
    createCar();
    scene.add(new THREE.AmbientLight(0xffffff, 0.3));

    // Kontroller
    let keys = {};
    window.onkeydown = (e) => { keys[e.key.toLowerCase()] = true; if(e.key === 't') answerCall(); };
    window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

    let speed = 0, rot = 0;

    function loop() {
        requestAnimationFrame(loop);

        // S√ºr√º≈ü Mekaniƒüi
        if(keys['w']) speed = Math.min(speed + 0.01, 1.5);
        else if(keys['s']) speed = Math.max(speed - 0.02, -0.4);
        else speed *= 0.98;

        if(keys['a']) rot += 0.04 * (speed > 0 ? 1 : -1);
        if(keys['d']) rot -= 0.04 * (speed > 0 ? 1 : -1);

        player.rotation.y = rot;
        player.translateZ(-speed);

        // Kamera Takibi (Hƒ±zla esner)
        let camDist = 15 + (speed * 5);
        let camHeight = 8 + (speed * 2);
        let offset = new THREE.Vector3(0, camHeight, camDist).applyMatrix4(player.matrixWorld);
        camera.position.lerp(offset, 0.1);
        camera.lookAt(player.position);

        // ƒ∞statistikler
        state.hunger -= 0.005;
        if(state.hunger < 20) state.stress += 0.01;
        updateUI();

        document.getElementById('speedo').innerText = Math.abs(Math.floor(speed * 140)) + " KM/H";
        renderer.render(scene, camera);
    }

    // Telefon Arama Sistemi
    function incomingCall() {
        let p = document.getElementById('phone');
        let caller = NPCs[Math.floor(Math.random()*NPCs.length)].name;
        document.getElementById('caller-id').innerText = "üìû " + caller;
        document.getElementById('incoming-call').style.display = 'block';
        p.classList.add('active');
        setTimeout(() => { 
            p.classList.remove('active'); 
            document.getElementById('incoming-call').style.display = 'none';
        }, 8000);
    }

    function answerCall() {
        alert("Arama Cevaplandƒ±: Bor√ßlarƒ±nƒ± √∂de yoksa mekanƒ±nƒ± basarƒ±z!");
        document.getElementById('incoming-call').style.display = 'none';
        document.getElementById('phone').classList.remove('active');
    }

    setInterval(incomingCall, 40000);
    loop();
</script>
</body>
</html>
