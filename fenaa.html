<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Mafia Dealer: The Life</title>
    <style>
        :root { --neon: #00f2ff; --pink: #ff007f; --gold: #ffd700; --red: #ff4757; }
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* UI HUD */
        #hud { position: fixed; top: 0; width: 100%; padding: 15px; display: flex; justify-content: space-between; background: rgba(0,0,0,0.8); z-index: 1000; border-bottom: 2px solid var(--neon); }
        .stat-item { text-align: center; border-right: 1px solid #333; padding: 0 20px; }
        .stat-val { display: block; font-size: 20px; font-weight: bold; color: var(--neon); }

        /* Ana Ekran DÃ¼zeni */
        #game-container { display: grid; grid-template-columns: 350px 1fr; height: 100vh; padding-top: 75px; }
        
        /* Sol: Ofis ve Hayat */
        #sidebar { background: #0a0a0a; border-right: 2px solid #222; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .menu-btn { background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 12px; cursor: pointer; border-radius: 5px; text-align: left; }
        .menu-btn:hover { border-color: var(--neon); background: #222; }

        /* SaÄŸ: Oyun AlanÄ± (3D ve Ofis) */
        #viewport { position: relative; background: #111; }
        #office-ui { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; padding: 50px; }
        
        /* Telefon */
        #phone { position: fixed; bottom: -450px; right: 30px; width: 220px; height: 400px; background: #151515; border: 4px solid #333; border-radius: 30px; transition: 0.5s; z-index: 2000; padding: 20px; }
        #phone.active { bottom: 20px; }

        .npc-box { background: #fff; color: #000; padding: 15px; border-radius: 10px; width: 100%; max-width: 500px; margin-bottom: 20px; font-weight: bold; }
        
        canvas { width: 100%; height: 100%; }
        #speedo { position: absolute; bottom: 30px; left: 30px; font-size: 40px; color: var(--neon); font-family: monospace; z-index: 100; text-shadow: 0 0 10px #000; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat-item">ğŸ’° <span id="m-val">500.000</span>â‚º</div>
    <div class="stat-item">â­ Ä°TÄ°BAR: <span id="r-val">10</span></div>
    <div class="stat-item">ğŸ  DURUM: <span id="f-val" style="color:var(--gold)">BEKAR</span></div>
    <div class="stat-item">ğŸ” TOKLUK: %<span id="h-val">100</span></div>
</div>

<div id="game-container">
    <div id="sidebar">
        <h2 style="color:var(--neon)">OPERASYON MERKEZÄ°</h2>
        <button class="menu-btn" onclick="showView('office')">ğŸ’¼ TÄ°CARET MASASI</button>
        <button class="menu-btn" onclick="startDrive()">ğŸš— SÃœRÃœÅE Ã‡IK (ÅEHÄ°R)</button>
        <button class="menu-btn" onclick="openFamily()">ğŸ‘ª AÄ°LE Ä°ÅLERÄ°</button>
        <button class="menu-btn" onclick="visitImam()">ğŸ•Œ Ä°MAM / CAMÄ°</button>
        <hr style="width:100%; border-color:#333;">
        <div id="car-inventory">
            <h4>GARAJIM</h4>
            <div id="cars-list">Araba yok.</div>
        </div>
        <button class="menu-btn" onclick="togglePhone()" style="margin-top:auto; background:var(--pink)">ğŸ“± TELEFON</button>
    </div>

    <div id="viewport">
        <div id="speedo" class="hidden">0 KM/H</div>
        <canvas id="stage"></canvas>

        <div id="office-ui">
            <div id="npc-avatar" style="font-size:80px;">ğŸ‘¤</div>
            <div class="npc-box" id="dialog">"Usta hayÄ±rlÄ± iÅŸler. Sana bir teklifim var."</div>
            <div id="trade-actions">
                <button class="menu-btn" onclick="trade('buy')">SATIN AL</button>
                <button class="menu-btn" onclick="trade('sell')">SAT</button>
                <button class="menu-btn" onclick="trade('kick')">KOV</button>
            </div>
        </div>
    </div>
</div>

<div id="phone">
    <h4 style="text-align:center; color:var(--pink)">REHBER</h4>
    <div style="font-size:12px;">
        ğŸ“ Tefeci Hayri<br>ğŸ“ EmlakÃ§Ä± Kerim<br>ğŸ“ NiÅŸanlÄ±m (Kilitli)
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // --- DATA ---
    let state = { money: 500000, rep: 10, hunger: 100, family: "Bekar", garage: [], currentNPC: null };
    const carModels = ["E46 M3", "Supra", "S2000", "Åahin", "TofaÅŸ", "M5 E60", "R34 GTR", "DoÄŸan SLX", "G63 AMG"];
    const npcNames = ["Baron Ziya", "Ã–ÄŸrenci Berk", "Mafya Ejder", "Esnaf Selim", "DayÄ± Osman", "Memur Veli"];

    // --- SÄ°STEMLER ---
    function updateUI() {
        document.getElementById('m-val').innerText = state.money.toLocaleString();
        document.getElementById('r-val').innerText = state.rep;
        document.getElementById('f-val').innerText = state.family;
        document.getElementById('h-val').innerText = Math.floor(state.hunger);
        
        const cl = document.getElementById('cars-list');
        cl.innerHTML = state.garage.length ? "" : "Araba yok.";
        state.garage.forEach((c, i) => {
            cl.innerHTML += `<div style="background:#222; padding:5px; margin-top:5px; font-size:12px;">ğŸš— ${c.name}</div>`;
        });
    }

    function showView(type) {
        if(type === 'office') {
            document.getElementById('office-ui').classList.remove('hidden');
            document.getElementById('speedo').classList.add('hidden');
            generateCustomer();
        } else {
            document.getElementById('office-ui').classList.add('hidden');
        }
    }

    function generateCustomer() {
        state.currentNPC = {
            name: npcNames[Math.floor(Math.random()*npcNames.length)],
            car: carModels[Math.floor(Math.random()*carModels.length)],
            price: Math.floor(Math.random()*2000000) + 100000
        };
        document.getElementById('dialog').innerText = `${state.currentNPC.name}: "Elimde bir ${state.currentNPC.car} var. â‚º${state.currentNPC.price.toLocaleString()} istiyorum. Ne dersin?"`;
    }

    function trade(act) {
        if(act === 'buy') {
            if(state.money >= state.currentNPC.price) {
                state.money -= state.currentNPC.price;
                state.garage.push({name: state.currentNPC.car, speed: Math.random() + 0.5});
                alert("HayÄ±rlÄ± olsun, araba garajda!");
            } else alert("Para yetersiz!");
        }
        generateCustomer();
        updateUI();
    }

    function openFamily() {
        if(state.family === "Bekar" && state.rep > 50) {
            if(confirm("Ä°tibarÄ±n iyi. Birisiyle tanÄ±ÅŸmak ister misin? (â‚º50.000 Gider)")) {
                state.money -= 50000; state.family = "SÃ¶zlÃ¼"; alert("SÃ¶z kesildi!");
            }
        } else if(state.family === "SÃ¶zlÃ¼" && state.money > 200000) {
            state.family = "NiÅŸanlÄ±"; alert("NiÅŸan yapÄ±ldÄ±!");
        } else {
            alert("Daha zamanÄ± var veya paran yetersiz!");
        }
        updateUI();
    }

    function visitImam() {
        state.rep += 5;
        state.hunger -= 10;
        alert("Ä°mam Efendi: 'EvladÄ±m dÃ¼rÃ¼st ol, rÄ±zkÄ±n artar.' (Ä°tibar kazandÄ±n)");
        updateUI();
    }

    // --- 3D ENGINE ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, (window.innerWidth-350)/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('stage'), antialias: true });
    renderer.setSize(window.innerWidth - 350, window.innerHeight);

    // AÃ§Ä±k DÃ¼nya: Binalar ve Yol
    const grid = new THREE.GridHelper(1000, 50, 0x444444, 0x222222);
    scene.add(grid);
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));

    for(let i=0; i<40; i++) {
        let h = Math.random()*30 + 10;
        let b = new THREE.Mesh(new THREE.BoxGeometry(10, h, 10), new THREE.MeshStandardMaterial({color: 0x1a1a1a}));
        b.position.set((Math.random()-0.5)*300, h/2, (Math.random()-0.5)*300);
        scene.add(b);
    }

    const player = new THREE.Group();
    scene.add(player);
    let carMesh;

    function buildCar() {
        player.clear();
        carMesh = new THREE.Mesh(new THREE.BoxGeometry(2, 0.8, 4), new THREE.MeshStandardMaterial({color: 0x00f2ff}));
        carMesh.position.y = 0.5;
        player.add(carMesh);
    }
    buildCar();

    let isDriving = false;
    let keys = {};
    window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
    window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

    function startDrive() {
        if(state.garage.length === 0) {
            alert("Araban yok kral, Ã¶nce ticaret yap!");
            return;
        }
        isDriving = true;
        showView('world');
        document.getElementById('speedo').classList.remove('hidden');
    }

    let speed = 0, rot = 0;
    function driveLoop() {
        requestAnimationFrame(driveLoop);
        if(!isDriving) return;

        if(keys['w']) speed = Math.min(speed + 0.01, 1.3);
        else if(keys['s']) speed = Math.max(speed - 0.02, -0.4);
        else speed *= 0.98;

        if(keys['a']) rot += 0.03;
        if(keys['d']) rot -= 0.03;

        player.rotation.y = rot;
        player.translateZ(-speed);

        let camOffset = new THREE.Vector3(0, 8, 15).applyMatrix4(player.matrixWorld);
        camera.position.lerp(camOffset, 0.1);
        camera.lookAt(player.position);

        document.getElementById('speedo').innerText = Math.floor(speed * 180) + " KM/H";
        renderer.render(scene, camera);
    }

    function togglePhone() { document.getElementById('phone').classList.toggle('active'); }

    // Start
    updateUI();
    driveLoop();
    showView('office');
</script>
</body>
</html>
