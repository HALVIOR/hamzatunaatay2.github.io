<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tuna Galeri: RPG Ultra</title>
<style>
    :root { --bg: #0a0a0a; --card: #151515; --gold: #f1c40f; --red: #e74c3c; --green: #2ecc71; --blue: #3498db; --neon-blue: #00d2ff; }
    body { margin: 0; background: var(--bg); color: #eee; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    
    /* Ãœst Panel */
    .top-header { background: #000; padding: 15px 25px; display: flex; justify-content: space-between; border-bottom: 2px solid #333; box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 100; }
    .stat-box { display: flex; flex-direction: column; gap: 5px; min-width: 120px; }
    .bar-outer { width: 100%; height: 8px; background: #222; border-radius: 4px; border: 1px solid #444; }
    .bar-inner { height: 100%; border-radius: 4px; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

    .main-grid { flex: 1; display: grid; grid-template-columns: 260px 1fr 320px; gap: 20px; padding: 20px; }
    
    /* Sol Navigasyon */
    .nav-panel { display: flex; flex-direction: column; gap: 12px; }
    .nav-link { background: var(--card); border: 1px solid #333; color: #aaa; padding: 18px; border-radius: 15px; cursor: pointer; transition: 0.3s; font-weight: 600; text-align: left; }
    .nav-link:hover { border-color: var(--blue); color: #fff; background: #1a1a1a; }
    .nav-link.active { background: linear-gradient(45deg, var(--blue), #2980b9); color: #fff; border: none; box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); }

    /* Ana Sahne */
    .viewport { background: #000; border-radius: 30px; border: 2px solid #222; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; box-shadow: inset 0 0 50px #000; }
    
    /* NPC Sistemi */
    #npc-card { text-align: center; width: 80%; animation: fadeIn 0.5s; }
    .npc-avatar { width: 140px; height: 140px; background: radial-gradient(#333, #111); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 70px; border: 3px solid var(--gold); box-shadow: 0 0 20px rgba(241, 196, 15, 0.2); }
    .chat-bubble { background: #fff; color: #222; padding: 20px; border-radius: 20px; margin-bottom: 25px; font-weight: 600; line-height: 1.4; position: relative; }
    .chat-bubble::after { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid #fff; }

    /* SaÄŸ Panel */
    .garage-panel { background: var(--card); border-radius: 30px; padding: 25px; border: 1px solid #333; display: flex; flex-direction: column; gap: 15px; }
    .car-preview { background: #000; height: 180px; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 80px; border: 1px solid #222; }
    
    /* Butonlar */
    .action-btn { border: none; padding: 15px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.2s; text-transform: uppercase; font-size: 13px; letter-spacing: 1px; }
    .btn-buy { background: var(--green); color: #052c16; }
    .btn-test { background: var(--gold); color: #423204; }
    .btn-sell { background: var(--blue); color: #fff; }
    .action-btn:hover { transform: translateY(-3px); filter: brightness(1.1); }

    /* SÃ¼rÃ¼ÅŸ EkranÄ± */
    #three-canvas { width: 100%; height: 100%; display: none; }
    #drive-overlay { position: absolute; top: 30px; width: 100%; text-align: center; display: none; pointer-events: none; z-index: 50; }
    #setup-modal { position: absolute; background: rgba(0,0,0,0.98); padding: 40px; border-radius: 25px; border: 1px solid var(--gold); text-align: center; display: none; z-index: 100; width: 340px; box-shadow: 0 0 100px rgba(0,0,0,1); }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

    <header class="top-header">
        <div class="stat-box">
            <span style="color:var(--green)">ğŸ’° NAKÄ°T</span>
            <span id="money-txt" style="font-size: 18px;">300.000 â‚º</span>
        </div>
        <div class="stat-box">
            <span style="color:var(--red)">ğŸ˜« STRES</span>
            <div class="bar-outer"><div id="stress-bar" class="bar-inner" style="background:var(--red); width:0%"></div></div>
        </div>
        <div class="stat-box">
            <span style="color:var(--neon-blue)">ğŸ•Œ Ä°MAN</span>
            <div class="bar-outer"><div id="faith-bar" class="bar-inner" style="background:var(--neon-blue); width:100%"></div></div>
        </div>
        <div class="stat-box">
            <span style="color:var(--gold)">ğŸ“… GÃœN</span>
            <span id="day-txt">Pazartesi</span>
        </div>
    </header>

    <div class="main-grid">
        <nav class="nav-panel">
            <div class="nav-link active" id="loc-galeri" onclick="goto('galeri')">ğŸ¢ ANA GALERÄ°</div>
            <div class="nav-link" id="loc-mahalle" onclick="goto('mahalle')">ğŸ˜ï¸ MAHALLE & CAMÄ°</div>
            <div class="nav-link" id="loc-sanayi" onclick="goto('sanayi')">ğŸ”§ OTO SANAYÄ°</div>
            <button class="action-btn" style="margin-top:auto; background: #222; color:#fff" onclick="endDay()">ğŸŒ™ GÃœNÃœ BÄ°TÄ°R</button>
        </nav>

        <main class="viewport" id="stage">
            <div id="npc-card">
                <div class="chat-bubble" id="chat">"HoÅŸgeldin kral. Yeni mallar geldi, bakmak ister misin?"</div>
                <div class="npc-avatar" id="avatar">ğŸ¤µ</div>
                <h2 id="npc-name" style="color:var(--gold); margin:0 0 20px 0;">Mahmut Efendi</h2>
                <div id="options" style="display:grid; gap:10px; width:280px; margin:0 auto;"></div>
            </div>

            <div id="setup-modal">
                <h2 style="color:var(--gold)">SÃœRÃœÅ AYARLARI</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:20px;">
                    <button class="action-btn btn-sell" onclick="selectedSpeed=0.5; this.style.border='2px solid white'">YAVAÅ</button>
                    <button class="action-btn btn-sell" onclick="selectedSpeed=1.2; this.style.border='2px solid white'">ORTA</button>
                    <button class="action-btn btn-sell" onclick="selectedSpeed=2.2; this.style.border='2px solid white'">HIZLI</button>
                </div>
                <button class="action-btn btn-buy" style="width:100%" onclick="launchDrive()">MOTORU Ã‡ALIÅTIR</button>
            </div>

            <div id="drive-overlay">
                <h1 id="timer" style="color:var(--red); font-size:50px; text-shadow: 0 0 20px rgba(0,0,0,0.5);">01:00</h1>
                <p>A - D ile makas at!</p>
            </div>
            <canvas id="three-canvas"></canvas>
        </main>

        <aside class="garage-panel">
            <h2 id="galery-title" onclick="setGalleryName()" style="text-align:center; cursor:pointer; color:var(--gold); margin:0;">TUNA GALERÄ° âœ</h2>
            <div class="car-preview" id="side-car-icon">ğŸ¢</div>
            <h3 id="side-car-name" style="text-align:center; margin:0">ARAÃ‡ YOK</h3>
            <p id="side-car-price" style="text-align:center; color:#888">Fiyat: -</p>
            <div id="side-actions" style="display:flex; flex-direction:column; gap:10px;">
                <button class="action-btn btn-sell" onclick="findCar()">ğŸš— ARAÃ‡ ARA</button>
            </div>
        </aside>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // --- DATA ---
    const CARS = [
        {n:"TofaÅŸ Åahin", p:280000, i:"ğŸš—", c:0xffffff},
        {n:"BMW M4", p:6200000, i:"ğŸï¸", c:0x0033ff},
        {n:"Mercedes G63", p:15500000, i:"ğŸšœ", c:0x111111}
    ];

    let game = {
        money: 300000, stress: 10, faith: 80, day: 0,
        car: null, loc: 'galeri', trend: 1.0
    };

    let selectedSpeed = 1.2;
    let isDriving = false;
    let bargainTries = 3;

    // --- LOGIC ---
    function goto(l) {
        game.loc = l;
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        document.getElementById('loc-'+l).classList.add('active');
        const opt = document.getElementById('options'); opt.innerHTML = "";

        if(l === 'galeri') {
            setNPC("ğŸ¤µ", "Mahmut Efendi", "DÃ¼kkan senin kral. Araban varsa teste Ã§Ä±karalÄ±m.");
            if(game.car) {
                opt.innerHTML = `<button class="action-btn btn-test" onclick="showSetup()">ğŸ TEST SÃœRÃœÅÃœ</button>
                                 <button class="action-btn btn-sell" onclick="sellMenu()">ğŸ’° MÃœÅTERÄ° BUL</button>`;
            }
        } else if(l === 'mahalle') {
            setNPC("ğŸ‘³", "HacÄ± Abi", "Selamun aleykÃ¼m evlat. Gel bir Ã§ayÄ±mÄ±zÄ± iÃ§, namazÄ±nÄ± kÄ±l.");
            opt.innerHTML = `<button class="action-btn btn-buy" onclick="pray()">ğŸ•Œ NAMAZ KIL (Ä°man +40)</button>`;
        } else if(l === 'sanayi') {
            setNPC("ğŸ‘¨â€ğŸ”§", "Tamirci Usta", "Usta dÃ¼kkan yoÄŸun! KarÅŸÄ±da kÃ¶fteci var, git bir stres at.");
            opt.innerHTML = `<button class="action-btn btn-sell" onclick="eat()">ğŸ´ KÃ–FTE YE (â‚º1500 / Stres -50)</button>`;
        }
        updateUI();
    }

    function findCar() {
        if(game.stress >= 90) return alert("Ã‡ok gerginsin! Git bir yemek ye.");
        bargainTries = 3;
        const c = CARS[Math.floor(Math.random()*CARS.length)];
        const price = Math.floor(c.p * game.trend * (0.9 + Math.random()*0.2));
        game.tempCar = {...c, currentPrice: price};
        
        setNPC("ğŸ‘¤", "Vedat (SatÄ±cÄ±)", `Åu ${c.n} tam senlik. â‚º${price.toLocaleString()} istiyorum.`);
        document.getElementById('options').innerHTML = `
            <button class="action-btn btn-buy" onclick="finalizeBuy()">SATIN AL</button>
            <button class="action-btn btn-test" onclick="tryBargain()">PAZARLIK YAP (${bargainTries})</button>
        `;
    }

    function tryBargain() {
        if(bargainTries <= 0) return setNPC("ğŸ‘¤", "Vedat", "Daha inmem kardeÅŸ, iÅŸine gelirse!");
        bargainTries--;
        if(Math.random() > 0.4) {
            game.tempCar.currentPrice = Math.floor(game.tempCar.currentPrice * 0.96);
            setNPC("ğŸ‘¤", "Vedat", `Tamam kÄ±rmayayÄ±m seni, â‚º${game.tempCar.currentPrice.toLocaleString()} olsun.`);
        } else {
            setNPC("ğŸ‘¤", "Vedat", "Kurtarmaz usta, son fiyat bu!");
        }
    }

    function finalizeBuy() {
        if(game.money >= game.tempCar.currentPrice) {
            game.money -= game.tempCar.currentPrice;
            game.car = {...game.tempCar, p: game.tempCar.currentPrice};
            game.stress += 25;
            goto('galeri');
        } else alert("Para yetersiz!");
    }

    function pray() { game.faith = Math.min(100, game.faith + 40); game.stress = Math.max(0, game.stress - 10); updateUI(); }
    function eat() { if(game.money >= 1500) { game.money -= 1500; game.stress = Math.max(0, game.stress - 50); updateUI(); } }
    
    function endDay() {
        game.day = (game.day + 1) % 7;
        game.trend = 0.8 + Math.random() * 0.4;
        alert("GÃ¼n Bitti! Piyasa DalgalandÄ±.");
        goto('galeri');
    }

    function setGalleryName() {
        const n = prompt("Yeni Galeri Ä°smi:");
        if(n) document.getElementById('galery-title').innerText = n.toUpperCase() + " âœ";
    }

    function setNPC(a, n, t) {
        document.getElementById('avatar').innerText = a;
        document.getElementById('npc-name').innerText = n;
        document.getElementById('chat').innerText = `"${t}"`;
    }

    function updateUI() {
        document.getElementById('money-txt').innerText = game.money.toLocaleString() + " â‚º";
        document.getElementById('stress-bar').style.width = game.stress + "%";
        document.getElementById('faith-bar').style.width = game.faith + "%";
        document.getElementById('day-txt').innerText = ["Pazartesi","SalÄ±","Ã‡arÅŸamba","PerÅŸembe","Cuma","Cumartesi","Pazar"][game.day];
        
        if(game.car) {
            document.getElementById('side-car-icon').innerText = game.car.i;
            document.getElementById('side-car-name').innerText = game.car.n;
            document.getElementById('side-car-price').innerText = "Fiyat: â‚º" + game.car.p.toLocaleString();
        }
    }

    // --- 3D SÃœRÃœÅ (MEKANÄ°K KORUNDU) ---
    const canvas = document.getElementById('three-canvas');
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x000000, 1, 80);
    const camera = new THREE.PerspectiveCamera(75, 2, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });

    const road = new THREE.Mesh(new THREE.PlaneGeometry(15, 300), new THREE.MeshStandardMaterial({ color: 0x111111 }));
    road.rotation.x = -Math.PI/2; scene.add(road);
    const lines = [];
    for(let i=0; i<30; i++) {
        let l = new THREE.Mesh(new THREE.PlaneGeometry(0.3, 6), new THREE.MeshBasicMaterial({ color: 0xffffff }));
        l.rotation.x = -Math.PI/2; l.position.set(0, 0.05, -i*15);
        scene.add(l); lines.push(l);
    }
    const playerCar = new THREE.Group();
    const hL = new THREE.SpotLight(0xffffff, 50, 40, Math.PI/6, 0.5);
    const hR = new THREE.SpotLight(0xffffff, 50, 40, Math.PI/6, 0.5);
    function buildCar(color) {
        playerCar.clear();
        const b = new THREE.Mesh(new THREE.BoxGeometry(1.6, 0.6, 3.5), new THREE.MeshStandardMaterial({color}));
        b.position.y = 0.5; hL.position.set(0.6, 0.6, -1.7); hR.position.set(-0.6, 0.6, -1.7);
        playerCar.add(b, hL, hR, hL.target, hR.target);
    }
    scene.add(playerCar, new THREE.AmbientLight(0xffffff, 0.1));
    camera.position.set(0, 6, 11); camera.lookAt(0, 0, -3);

    function showSetup() { document.getElementById('setup-modal').style.display = 'block'; }
    function launchDrive() {
        document.getElementById('setup-modal').style.display = 'none';
        document.getElementById('npc-card').style.display = 'none';
        document.getElementById('drive-overlay').style.display = 'block';
        canvas.style.display = 'block';
        isDriving = true;
        buildCar(game.car.c);
        animate();
    }

    function animate() {
        if(!isDriving) return;
        requestAnimationFrame(animate);
        lines.forEach(l => { l.position.z += selectedSpeed * 8; if(l.position.z > 20) l.position.z = -250; });
        renderer.render(scene, camera);
    }

    window.addEventListener('keydown', (e) => {
        if(!isDriving) return;
        if(e.key === 'a' || e.key === 'ArrowLeft') playerCar.position.x = Math.max(-6, playerCar.position.x - 0.7);
        if(e.key === 'd' || e.key === 'ArrowRight') playerCar.position.x = Math.min(6, playerCar.position.x + 0.7);
        if(e.key === 'Escape') { isDriving = false; canvas.style.display='none'; document.getElementById('npc-card').style.display='block'; document.getElementById('drive-overlay').style.display='none'; }
    });

    goto('galeri');
</script>
</body>
</html>
