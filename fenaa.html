<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Tuna Galeri: Mafia Empire</title>
    <style>
        :root { --neon: #00f2ff; --pink: #ff007f; --gold: #ffd700; --red: #ff4757; }
        body { margin: 0; background: #050505; color: #eee; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* Dashboard */
        .hud { position: fixed; top: 0; width: 100%; padding: 15px; display: flex; justify-content: space-around; background: rgba(0,0,0,0.9); border-bottom: 2px solid #222; z-index: 1000; }
        .stat { text-align: center; }
        .stat b { display: block; font-size: 12px; color: #888; }
        .stat span { font-size: 18px; color: var(--neon); font-weight: bold; }

        .main-grid { display: grid; grid-template-columns: 350px 1fr 300px; height: 100vh; padding-top: 70px; }
        
        /* Sol: Operasyon Paneli */
        .panel { background: #0a0a0a; border-right: 1px solid #333; padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .card { background: #151515; border: 1px solid #333; padding: 15px; border-radius: 8px; position: relative; }
        .btn { background: #222; border: 1px solid var(--neon); color: #fff; padding: 10px; cursor: pointer; width: 100%; border-radius: 4px; font-weight: bold; margin-top: 5px; }
        .btn:hover { background: var(--neon); color: #000; }
        .btn-risk { border-color: var(--red); color: var(--red); }

        /* Orta: DÃ¼nya & SÃ¼rÃ¼ÅŸ */
        .world { position: relative; background: #000; border-right: 1px solid #333; }
        #speedo { position: absolute; bottom: 20px; left: 20px; font-size: 40px; color: var(--neon); font-family: monospace; }
        #event-log { position: absolute; top: 20px; right: 20px; width: 250px; pointer-events: none; }
        .log-entry { background: rgba(255,0,0,0.2); border-left: 4px solid var(--red); padding: 8px; margin-bottom: 5px; font-size: 12px; animation: slideIn 0.3s; }

        /* SaÄŸ: MÃ¼ÅŸteri & PazarlÄ±k */
        .trade-zone { background: #0a0a0a; padding: 20px; }
        .customer-ui { text-align: center; border: 2px solid var(--gold); padding: 15px; border-radius: 15px; display: none; }
        
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

<div class="hud">
    <div class="stat"><b>KASA</b> <span id="h-money">500,000</span>â‚º</div>
    <div class="stat"><b>Ä°TÄ°BAR</b> <span id="h-rep" style="color:var(--gold)">50</span></div>
    <div class="stat"><b>KORKU</b> <span id="h-fear" style="color:var(--pink)">0</span></div>
    <div class="stat"><b>AÃ‡LIK</b> <span id="h-hunger">100</span>%</div>
</div>

<div class="main-grid">
    <div class="panel">
        <h3 style="color:var(--neon)">Ä°MPERATORLUK</h3>
        <div class="card">
            <b>ğŸ“ Merkez Galeri</b>
            <p style="font-size:12px; color:#666;">Kapasite: 3 AraÃ§</p>
            <button class="btn" onclick="buyBranch()">YENÄ° ÅUBE AÃ‡ (â‚º2.0M)</button>
        </div>
        
        <div id="garage">
            <h4 style="margin-bottom:5px;">GARAJ</h4>
            <div id="car-list"></div>
        </div>

        <button class="btn btn-risk" onclick="triggerPolice()">ğŸš¨ RÃœÅVET DAÄIT (â‚º50k)</button>
    </div>

    <div class="world">
        <canvas id="drive-canvas"></canvas>
        <div id="speedo">0 KM/H</div>
        <div id="event-log"></div>
    </div>

    <div class="trade-zone">
        <h3 style="color:var(--gold)">MÃœÅTERÄ° BEKLÄ°YOR</h3>
        <div id="no-customer" style="color:#444; text-align:center; margin-top:50px;">KapÄ±da kimse yok...</div>
        
        <div class="customer-ui" id="customer-ui">
            <div id="c-icon" style="font-size:50px;">ğŸ‘¤</div>
            <h4 id="c-name">Ã–ÄŸrenci Ali</h4>
            <p id="c-desc" style="font-size:13px; color:#aaa;">"Abi okul iÃ§in uygun bir ÅŸey lazÄ±m."</p>
            <div id="negotiation">
                <p id="c-offer" style="font-weight:bold; color:var(--neon)"></p>
                <button class="btn" onclick="deal('sell')">SAT</button>
                <button class="btn btn-risk" onclick="deal('lie')">YALAN SÃ–YLE (Pert DeÄŸil)</button>
                <button class="btn" style="border-color:#555" onclick="deal('reject')">KOV</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    let game = {
        money: 500000, rep: 50, fear: 10, hunger: 100,
        cars: [], currentCustomer: null
    };

    // --- MEKANÄ°KLER ---
    function spawnCar() {
        const models = [
            {n: "Egea", p: 800000, condition: "Temiz", km: 45000},
            {n: "M4", p: 6000000, condition: "Pert KayÄ±tlÄ±", km: 120000},
            {n: "Åahin", p: 200000, condition: "HasarlÄ±", km: 280000}
        ];
        const c = models[Math.floor(Math.random()*models.length)];
        // Risk FaktÃ¶rÃ¼: Kilometre Ã§ekilmiÅŸ olabilir mi?
        c.realCondition = Math.random() > 0.7 ? "AÄŸÄ±r HasarlÄ±" : c.condition;
        game.cars.push(c);
        updateUI();
    }

    function spawnCustomer() {
        const types = [
            {n: "Ã–ÄŸrenci Berk", d: "Ã‡ok titiz, ekspertiz ister.", risk: 0.1, type: "student"},
            {n: "Mafya Ejder", d: "PazarlÄ±k sevmez, yamuk istemez.", risk: 0.8, type: "mafia"},
            {n: "Zengin Ä°ÅŸ AdamÄ±", d: "HÄ±zlÄ± alÄ±r, paraya bakmaz.", risk: 0.2, type: "rich"}
        ];
        game.currentCustomer = types[Math.floor(Math.random()*types.length)];
        document.getElementById('no-customer').style.display = 'none';
        const ui = document.getElementById('customer-ui');
        ui.style.display = 'block';
        document.getElementById('c-name').innerText = game.currentCustomer.n;
        document.getElementById('c-desc').innerText = game.currentCustomer.d;
        
        if(game.cars.length > 0) {
            let car = game.cars[0];
            document.getElementById('c-offer').innerText = car.n + " iÃ§in â‚º" + (car.p * 1.1).toLocaleString();
        }
    }

    function deal(action) {
        if(game.cars.length === 0) return;
        let car = game.cars[0];
        let cust = game.currentCustomer;

        if(action === 'sell') {
            game.money += car.p * 1.05;
            game.rep += 5;
            log("SatÄ±ÅŸ baÅŸarÄ±lÄ±. Ä°tibar kazandÄ±n.");
        } else if(action === 'lie') {
            // Yalan SÃ¶yleme MekaniÄŸi
            if(Math.random() < 0.5) {
                game.money += car.p * 1.3;
                game.rep -= 10;
                log("YalanÄ±n tuttu! BÃ¼yÃ¼k para kazandÄ±n.", "gold");
            } else {
                game.rep -= 30;
                game.fear += 20;
                log("YAKALANDIN! MÃ¼ÅŸteri dÃ¼kkanÄ± birbirine kattÄ±.", "red");
                if(cust.type === 'mafia') {
                    game.money -= 200000;
                    log("Mafya ceza kesti: â‚º200k uÃ§tu.", "red");
                }
            }
        }
        
        game.cars.shift();
        document.getElementById('customer-ui').style.display = 'none';
        document.getElementById('no-customer').style.display = 'block';
        updateUI();
    }

    function log(msg, color="white") {
        const l = document.getElementById('event-log');
        const div = document.createElement('div');
        div.className = 'log-entry';
        div.style.borderColor = color === "red" ? "var(--red)" : "var(--neon)";
        div.innerText = msg;
        l.prepend(div);
        setTimeout(() => div.remove(), 5000);
    }

    function updateUI() {
        document.getElementById('h-money').innerText = game.money.toLocaleString();
        document.getElementById('h-rep').innerText = game.rep;
        document.getElementById('h-fear').innerText = game.fear;
        document.getElementById('h-hunger').innerText = Math.floor(game.hunger);
        
        const list = document.getElementById('car-list');
        list.innerHTML = game.cars.map(c => `<div class="card" style="font-size:12px"><b>${c.n}</b><br>${c.condition} | ${c.km}km</div>`).join('');
    }

    // --- 3D SÃœRÃœÅ MOTORU (DÄ°NAMÄ°K) ---
    const canvas = document.getElementById('drive-canvas');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, (window.innerWidth-650)/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    renderer.setSize(window.innerWidth - 650, window.innerHeight);

    const road = new THREE.GridHelper(1000, 40, 0x222222, 0x111111);
    scene.add(road);
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));

    const player = new THREE.Group();
    const body = new THREE.Mesh(new THREE.BoxGeometry(2, 0.8, 4), new THREE.MeshStandardMaterial({color: 0x00f2ff}));
    body.position.y = 0.5;
    player.add(body);
    scene.add(player);

    let keys = {};
    window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
    window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

    let speed = 0, rot = 0;

    function animate() {
        requestAnimationFrame(animate);
        
        if(keys['w']) speed = Math.min(speed + 0.01, 1.2);
        else if(keys['s']) speed = Math.max(speed - 0.02, -0.4);
        else speed *= 0.98;

        if(keys['a']) rot += 0.03 * (speed > 0 ? 1 : -1);
        if(keys['d']) rot -= 0.03 * (speed > 0 ? 1 : -1);

        player.rotation.y = rot;
        player.translateZ(-speed);

        // Kamera
        let offset = new THREE.Vector3(0, 8, 14).applyMatrix4(player.matrixWorld);
        camera.position.lerp(offset, 0.1);
        camera.lookAt(player.position);

        // Rastgele Polis Ã‡evirmesi
        if(speed > 0.8 && Math.random() < 0.001) {
            speed = 0;
            log("ğŸš¨ POLÄ°S: HÄ±z sÄ±nÄ±rÄ±nÄ± aÅŸtÄ±n! Ceza: â‚º5,000", "red");
            game.money -= 5000;
        }

        document.getElementById('speedo').innerText = Math.abs(Math.floor(speed * 180)) + " KM/H";
        renderer.render(scene, camera);
    }

    // DÃ¶ngÃ¼ler
    setInterval(spawnCar, 30000);
    setInterval(spawnCustomer, 15000);
    setInterval(() => { game.hunger -= 1; updateUI(); }, 10000);
    
    updateUI();
    animate();
    spawnCar();
</script>
</body>
</html>
