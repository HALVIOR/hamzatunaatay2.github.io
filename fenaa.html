<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Mafya & Galeri Tycoon</title>
<style>
    body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #050505; color: white; }
    #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; padding: 20px; box-sizing: border-box; z-index: 10; }
    
    .top-panel { pointer-events: auto; background: rgba(0,0,0,0.9); padding: 10px; display: flex; gap: 10px; border-radius: 10px; align-self: center; border: 1px solid #c0392b; }
    .stat-box { text-align: center; min-width: 60px; }
    .stat-val { font-size: 1em; font-weight: bold; display: block; color: #2ecc71; }
    .stat-label { font-size: 0.6em; color: #888; text-transform: uppercase; }

    .bottom-panel { pointer-events: auto; display: flex; justify-content: space-between; align-items: flex-end; width: 100%; }
    .panel-box { background: rgba(0,0,0,0.95); padding: 15px; border-radius: 12px; width: 280px; border: 1px solid #444; }
    
    .car-img-container { width: 100%; height: 120px; background: #000; border-radius: 8px; margin-bottom: 8px; overflow: hidden; border: 1px solid #333; position: relative; }
    #carPhoto { width: 100%; height: 100%; object-fit: contain; }

    button { width: 100%; padding: 8px; margin-top: 4px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; transition: 0.2s; }
    button:hover { filter: brightness(1.2); }
    .btn-buy { background: #27ae60; }
    .btn-sell { background: #2980b9; }
    .btn-dark { background: #2c3e50; color: #e74c3c; border: 1px solid #e74c3c; }
    .btn-next { background: #8e44ad; margin-top: 10px; }

    #msg-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #000; padding: 25px; border-radius: 15px; display: none; z-index: 200; text-align: center; border: 2px solid #e74c3c; width: 320px; box-shadow: 0 0 50px rgba(231, 76, 60, 0.5); }
</style>
</head>
<body>

<div id="msg-box">
    <div id="msg-content" style="margin-bottom: 15px;"></div>
    <div id="mafya-choice" style="display:none">
        <button class="btn-buy" onclick="mafyaPay(true)">HaraÃ§ Ver (â‚º50k)</button>
        <button class="btn-dark" onclick="mafyaPay(false)">Vermiyorum ulan!</button>
    </div>
    <button id="restart-btn" style="display:none" onclick="location.reload()">YENÄ° KARÄ°YER</button>
</div>

<div id="ui-layer">
    <div class="top-panel">
        <div class="stat-box"><span class="stat-val" id="dayTxt">Pzt</span><span class="stat-label">GÃœN</span></div>
        <div class="stat-box"><span class="stat-val" id="moneyTxt">â‚º300k</span><span class="stat-label">NAKÄ°T</span></div>
        <div class="stat-box"><span class="stat-val" id="debtTxt" style="color:red">â‚º0</span><span class="stat-label">BORÃ‡</span></div>
        <div class="stat-box"><span class="stat-val" id="hungerTxt" style="color:orange">20%</span><span class="stat-label">AÃ‡LIK</span></div>
    </div>

    <div class="bottom-panel">
        <div class="panel-box">
            <h4 style="margin:0; color:#e74c3c;">ğŸ•µï¸ MAFYA & TEFECÄ°</h4>
            <button class="btn-dark" onclick="loan()">ğŸ’° Tefeciden â‚º100k Ã‡ek</button>
            <button class="btn-sell" onclick="payDebt()">ğŸ¦ BorÃ§ Ã–de (â‚º50k)</button>
            <hr style="border:0.5px solid #222">
            <button class="btn-dark" style="background:#444; color:white;" onclick="action('market')">ğŸ›’ Market (-â‚º1k)</button>
            <button class="btn-next" onclick="nextDay()">ğŸŒ™ GÃœNÃœ BÄ°TÄ°R (Pazar Vergi)</button>
        </div>

        <div class="panel-box">
            <div class="car-img-container"><img id="carPhoto" src=""></div>
            <input type="text" id="galeryName" value="Tuna Galeri" style="background:none; border:none; color:gold; font-size:1em; font-weight:bold; width:100%; text-align:center; pointer-events:auto;">
            <p id="carInfo" style="margin:5px 0; text-align:center; font-size:0.8em; color:#aaa;">AraÃ§ Yok</p>
            <button class="btn-buy" id="buyBtn" onclick="buyCar()">ğŸ›’ AraÃ§ SatÄ±n Al</button>
            <button class="btn-sell" id="sellBtn" style="display:none" onclick="sellCar()">ğŸ’° Piyasa FiyatÄ±na Sat</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
const carModels = [
    {n:"TofaÅŸ Åahin", p:200, c:0xffffff}, {n:"DoÄŸan SLX", p:250, c:0xaaaaaa}, {n:"Toros", p:150, c:0xdddddd}, {n:"Lada Samara", p:120, c:0x555555},
    {n:"Fiat Egea", p:800, c:0xcccccc}, {n:"Renault Clio", p:750, c:0xff0000}, {n:"Toyota Corolla", p:1200, c:0xeeeeee}, {n:"Honda Civic", p:1300, c:0x0000ff},
    {n:"VW Golf", p:1500, c:0x333333}, {n:"Passat", p:2000, c:0x000000}, {n:"BMW 3.20", p:3500, c:0x000088}, {n:"Mercedes C200", p:3800, c:0x444444},
    {n:"Audi A6", p:4500, c:0x111111}, {n:"Range Rover", p:7000, c:0x222222}, {n:"Porsche 911", p:12000, c:0xffff00}, {n:"Ferrari F430", p:25000, c:0xff0000},
    {n:"Lamborghini Aventador", p:35000, c:0xff6600}, {n:"Bugatti Chiron", p:80000, c:0x0000ff}
    // ... 40'a kadar bu mantÄ±kla pazar geniÅŸliyor
];

let state = { money: 300000, debt: 0, dayIdx: 0, hunger: 20, car: null, alive: true };
const days = ["Pazartesi", "SalÄ±", "Ã‡arÅŸamba", "PerÅŸembe", "Cuma", "Cumartesi", "Pazar"];

// 3D KURULUM
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const carGeometry = new THREE.BoxGeometry(2, 0.8, 4);
const carMaterial = new THREE.MeshStandardMaterial({color: 0x555555});
const carMesh = new THREE.Mesh(carGeometry, carMaterial);
scene.add(carMesh);
scene.add(new THREE.AmbientLight(0xffffff, 0.5));
const sun = new THREE.DirectionalLight(0xffffff, 1); sun.position.set(5,5,5); scene.add(sun);
camera.position.set(4, 3, 5); camera.lookAt(0,0,0);

function updateUI() {
    document.getElementById("moneyTxt").innerText = "â‚º" + Math.floor(state.money/1000) + "k";
    document.getElementById("debtTxt").innerText = "â‚º" + Math.floor(state.debt/1000) + "k";
    document.getElementById("dayTxt").innerText = days[state.dayIdx].substring(0,3);
    document.getElementById("hungerTxt").innerText = state.hunger + "%";
    
    if(state.car) {
        document.getElementById("carInfo").innerText = state.car.n;
        document.getElementById("carPhoto").src = "https://via.placeholder.com/300x150/222/fff?text=" + state.car.n;
        document.getElementById("buyBtn").style.display = "none";
        document.getElementById("sellBtn").style.display = "block";
        carMesh.visible = true;
        carMesh.material.color.setHex(state.car.c);
    } else {
        document.getElementById("carInfo").innerText = "Pazar Bekleniyor...";
        document.getElementById("carPhoto").src = "";
        document.getElementById("buyBtn").style.display = "block";
        document.getElementById("sellBtn").style.display = "none";
        carMesh.visible = false;
    }
}

function buyCar() {
    let randomCar = carModels[Math.floor(Math.random() * carModels.length)];
    let price = randomCar.p * 1000;
    if(state.money >= price) {
        state.money -= price;
        state.car = randomCar;
        updateUI();
        showAlert(randomCar.n + " satÄ±n alÄ±ndÄ±!");
    } else showAlert("Para yetmiyor!");
}

function sellCar() {
    let profit = (state.car.p * 1000) * (0.8 + Math.random() * 0.5);
    state.money += Math.floor(profit);
    state.car = null;
    updateUI();
    showAlert("AraÃ§ satÄ±ldÄ±: â‚º" + Math.floor(profit).toLocaleString());
}

function nextDay() {
    state.dayIdx++; if(state.dayIdx > 6) state.dayIdx = 0;
    state.hunger += 15;
    if(state.debt > 0) state.debt = Math.floor(state.debt * 1.1);
    
    // MAFYA OLAYI (%20 Åans)
    if(state.money > 500000 && Math.random() < 0.2) {
        triggerMafya();
        return;
    }

    if(days[state.dayIdx] === "Pazar") {
        let tax = Math.floor(state.money * 0.15);
        state.money -= tax; showAlert("HaftalÄ±k Vergi: â‚º" + tax);
    }
    updateUI();
}

function triggerMafya() {
    const box = document.getElementById("msg-box");
    const content = document.getElementById("msg-content");
    content.innerHTML = "<b style='color:red'>KAPI Ã‡ALDI!</b><br>Mafya geldi. 'Bu mahallede bizden habersiz dÃ¼kkan dÃ¶nmez' diyorlar.";
    document.getElementById("mafya-choice").style.display = "block";
    box.style.display = "block";
}

function mafyaPay(choice) {
    if(choice) {
        state.money -= 50000;
        showAlert("HaraÃ§ verildi, mekanÄ± kurtardÄ±n.");
    } else {
        gameOver("Mafya mekanÄ± ateÅŸe verdi! Her ÅŸeyini kaybettin.");
    }
    document.getElementById("mafya-choice").style.display = "none";
}

function gameOver(txt) {
    state.alive = false;
    document.getElementById("msg-content").innerHTML = "<h2 style='color:red'>KARÄ°YER BÄ°TTÄ°</h2>" + txt;
    document.getElementById("restart-btn").style.display = "block";
    document.getElementById("msg-box").style.display = "block";
}

function loan() { state.debt += 100000; state.money += 100000; updateUI(); }
function payDebt() { if(state.money >= 50000) { state.money -= 50000; state.debt -= 50000; } updateUI(); }
function action(type) { if(state.money >= 1000) { state.money -= 1000; state.hunger = 0; } updateUI(); }

function showAlert(txt) {
    const box = document.getElementById("msg-box");
    document.getElementById("msg-content").innerText = txt;
    box.style.display = "block";
    setTimeout(() => { if(state.alive && document.getElementById("mafya-choice").style.display === "none") box.style.display = "none"; }, 1500);
}

function animate() { requestAnimationFrame(animate); carMesh.rotation.y += 0.01; renderer.render(scene, camera); }
animate();
updateUI();
</script>
</body>
</html>
