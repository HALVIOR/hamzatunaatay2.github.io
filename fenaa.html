<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GTA 7: Hustle & Flow</title>
    <style>
        body { margin: 0; background: #1a1a1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; }
        canvas { display: block; cursor: crosshair; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; width: 95%; }
        .stat-box { display: flex; justify-content: space-between; align-items: flex-start; }
        #money { color: #2ecc71; font-size: 40px; font-weight: bold; text-shadow: 2px 2px #000; }
        #wanted { color: #f1c40f; font-size: 35px; letter-spacing: 5px; }
        #hp-bar { width: 200px; height: 20px; background: #c0392b; border: 2px solid #fff; margin-top: 10px; }
        #hp-fill { width: 100%; height: 100%; background: #2ecc71; transition: 0.3s; }
        #shop-menu { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 30px; border: 3px solid #f1c40f; 
            display: none; text-align: center; border-radius: 15px;
        }
        .btn { background: #f1c40f; color: #000; padding: 10px 20px; border: none; cursor: pointer; font-weight: bold; margin: 10px; }
        .controls { position: absolute; bottom: 10px; left: 10px; font-size: 12px; color: #aaa; background: rgba(0,0,0,0.5); padding: 5px; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-box">
        <div>
            <div id="money">$0</div>
            <div id="hp-bar"><div id="hp-fill"></div></div>
        </div>
        <div id="wanted"></div>
    </div>
</div>

<div id="shop-menu">
    <h2>MODİFİYE & MARKET</h2>
    <p>Bakım Seti (Full HP): <b>$1000</b> <br><button class="btn" onclick="buy('hp')">SATIN AL</button></p>
    <p>Motor Güçlendirme (Hız+): <b>$5000</b> <br><button class="btn" onclick="buy('speed')">SATIN AL</button></p>
    <button class="btn" style="background:#fff" onclick="document.getElementById('shop-menu').style.display='none'">KAPAT</button>
</div>

<div class="controls">
    WASD: Hareket | Mouse: Ateş | E: Araba | F: Konuş | <b>H: Haraç Kes</b> | <b>P: Market</b>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gameState = { money: 0, stars: 0, hp: 100, speed: 4 };
let player = { x: 400, y: 300, rot: 0, inCar: false };
let car = { x: 600, y: 400, rot: 0, w: 90, h: 50, color: "#f1c40f" };
let npcs = [];
let bullets = [];
let loots = [];
let keys = {};

// NPC Başlatma
for(let i=0; i<6; i++) spawnNPC();

window.addEventListener("keydown", e => {
    keys[e.code] = true;
    if(e.code === 'KeyP') toggleShop();
    if(e.code === 'KeyH') extort();
    if(e.code === 'KeyE') toggleCar();
});
window.addEventListener("keyup", e => keys[e.code] = false);
window.addEventListener("mousedown", shoot);

function spawnNPC() {
    npcs.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        hp: 100,
        color: `hsl(${Math.random()*360}, 50%, 50%)`,
        name: "Vatandaş #" + Math.floor(Math.random()*100),
        dead: false
    });
}

function shoot(e) {
    if(player.inCar) return;
    const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
    bullets.push({ x: player.x, y: player.y, vx: Math.cos(angle)*15, vy: Math.sin(angle)*15 });
}

function extort() {
    npcs.forEach(n => {
        if(!n.dead && Math.hypot(player.x - n.x, player.y - n.y) < 60) {
            gameState.money += 200;
            gameState.stars = Math.min(5, gameState.stars + 1);
            alert(n.name + ": Tamam abi al cüzdanı, dokunma bize!");
        }
    });
}

function toggleShop() {
    const s = document.getElementById('shop-menu').style;
    s.display = s.display === 'block' ? 'none' : 'block';
}

function buy(item) {
    if(item === 'hp' && gameState.money >= 1000) {
        gameState.hp = 100; gameState.money -= 1000;
    } else if(item === 'speed' && gameState.money >= 5000) {
        gameState.speed += 2; gameState.money -= 5000;
    } else {
        alert("Para yetersiz kanka!");
    }
}

function toggleCar() {
    let d = Math.hypot(player.x - car.x, player.y - car.y);
    if(!player.inCar && d < 70) player.inCar = true;
    else if(player.inCar) { player.inCar = false; player.x += 80; }
}

function update() {
    let speed = player.inCar ? 10 : gameState.speed;
    let target = player.inCar ? car : player;

    if(keys['KeyW']) target.y -= speed;
    if(keys['KeyS']) target.y += speed;
    if(keys['KeyA']) target.x -= speed;
    if(keys['KeyD']) target.x += speed;

    if(player.inCar) { player.x = car.x; player.y = car.y; }

    // Mermi - NPC Çatışması
    bullets.forEach((b, bi) => {
        b.x += b.vx; b.y += b.vy;
        npcs.forEach(n => {
            if(!n.dead && Math.hypot(b.x - n.x, b.y - n.y) < 25) {
                n.hp -= 50;
                bullets.splice(bi, 1);
                if(n.hp <= 0) {
                    n.dead = true;
                    loots.push({x: n.x, y: n.y, val: 500});
                    gameState.stars = Math.min(5, gameState.stars + 1);
                }
            }
        });
    });

    // Loot toplama
    loots.forEach((l, i) => {
        if(Math.hypot(player.x - l.x, player.y - l.y) < 30) {
            gameState.money += l.val;
            loots.splice(i, 1);
        }
    });

    document.getElementById("money").innerText = "$" + gameState.money;
    document.getElementById("wanted").innerText = "★".repeat(gameState.stars);
    document.getElementById("hp-fill").style.width = gameState.hp + "%";
}

function drawHuman(x, y, color, isDead) {
    if(isDead) ctx.globalAlpha = 0.5;
    ctx.fillStyle = color;
    ctx.fillRect(x-12, y-12, 24, 24); // Gövde
    ctx.fillStyle = "#ffdbac";
    ctx.beginPath(); ctx.arc(x, y, 8, 0, Math.PI*2); ctx.fill(); // Kafa
    ctx.globalAlpha = 1;
}

function draw() {
    ctx.fillStyle = "#34495e";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Araba
    ctx.fillStyle = car.color;
    ctx.fillRect(car.x-car.w/2, car.y-car.h/2, car.w, car.h);

    // Loots (Yerdeki paralar)
    loots.forEach(l => {
        ctx.fillStyle = "#2ecc71";
        ctx.beginPath(); ctx.arc(l.x, l.y, 10, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "white"; ctx.fillText("$", l.x-3, l.y+4);
    });

    // NPCs
    npcs.forEach(n => {
        drawHuman(n.x, n.y, n.dead ? "#333" : n.color, n.dead);
        if(!n.dead) {
            ctx.fillStyle = "white"; ctx.font = "10px Arial";
            ctx.fillText(n.name, n.x-20, n.y-25);
        }
    });

    // Player
    if(!player.inCar) drawHuman(player.x, player.y, "#3498db", false);

    // Bullets
    ctx.fillStyle = "yellow";
    bullets.forEach(b => ctx.fillRect(b.x, b.y, 5, 5));

    update();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
