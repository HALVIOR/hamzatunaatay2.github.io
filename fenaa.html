<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>BRABUS G-WAGON: SANAYİ SHOWROOM</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; }
        canvas { display: block; width: 100%; height: 100vh; }
        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #e67e22; font-size: 1.5rem; }
        #info { position: absolute; bottom: 20px; left: 20px; color: #fff; text-shadow: 2px 2px 4px #000; }
        #controls { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; }
        .btn { background: #e67e22; border: none; padding: 8px 12px; color: white; font-weight: bold; cursor: pointer; margin-top: 5px; width: 100%; }
    </style>
    <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
</head>
<body>

<div id="loading">BRABUS Yükleniyor... Sanayi Hazırlanıyor...</div>
<div id="info">
    <h1 style="margin: 0; color: #e67e22;">BRABUS G800</h1>
    <p>Sanayi Baronu Özel Yapım. | Mouse ile çevir, tekerlekle yaklaş.</p>
</div>

<div id="controls">
    <h3 style="margin:0; color:#e67e22">Kontroller</h3>
    <button class="btn" onclick="toggleLights()">Farları Aç/Kapa</button>
    <button class="btn" onclick="rotateCar()">Otomatik Döndür</button>
</div>

<script>
let scene, camera, renderer, controls, car;
let headlights = [], isRotating = false;

function init() {
    // SAHNE VE KAMERA
    scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x0a0a0a, 10, 50);

    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(5, 2, 5);

    // RENDERER
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1;
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // KONTROLLER
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.maxDistance = 15;
    controls.minDistance = 2;

    // IŞIKLAR (Gece Modu)
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
    scene.add(ambientLight);

    const spotLight = new THREE.SpotLight(0xffffff, 1);
    spotLight.position.set(0, 10, 0);
    spotLight.angle = Math.PI / 6;
    spotLight.penumbra = 0.5;
    spotLight.castShadow = true;
    scene.add(spotLight);

    // ZEMİN (Asfalt)
    const floorGeometry = new THREE.PlaneGeometry(100, 100);
    const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 0.9, roughness: 0.5 });
    const floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

    // MODELİ YÜKLE (Buraya Brabus modelinin adını yaz)
    const loader = new THREE.GLTFLoader();
    loader.load('brabus.glb', function(gltf) { // <-- Model adını buradan değiştir
        car = gltf.scene;
        car.scale.set(1, 1, 1); // Gerekirse boyutu ayarla
        car.position.set(0, 0, 0);
        
        car.traverse(function(node) {
            if(node.isMesh) {
                node.castShadow = true;
                node.receiveShadow = true;
                // Brabus logosu veya farlar için materyal bulma (Örnek)
                if(node.name.includes("Headlight")) headlights.push(node);
            }
        });

        scene.add(car);
        document.getElementById("loading").style.display = "none";
        
        // Farları ekle (Basit bir spot ışığı olarak)
        createHeadlights();

    }, undefined, function(error) {
        console.error(error);
        document.getElementById("loading").innerHTML = "HATA: Model yüklenemedi! (Dosya adını kontrol et)";
        document.getElementById("loading").style.color = "red";
    });

    // ÇEVRE (HDRI - İsteğe bağlı)
    // new THREE.RGBELoader().load('sanayi_night.hdr', function(texture) {
    //     texture.mapping = THREE.EquirectangularReflectionMapping;
    //     scene.environment = texture;
    //     scene.background = texture;
    // });

    window.addEventListener('resize', onWindowResize);
    animate();
}

function createHeadlights() {
    const leftLight = new THREE.SpotLight(0xffffff, 2, 20, Math.PI/8, 0.5, 1);
    leftLight.position.set(0.8, 0.8, -1.5); // Konumu modele göre ayarla
    leftLight.target.position.set(0.8, 0, -10);
    
    const rightLight = new THREE.SpotLight(0xffffff, 2, 20, Math.PI/8, 0.5, 1);
    rightLight.position.set(-0.8, 0.8, -1.5); // Konumu modele göre ayarla
    rightLight.target.position.set(-0.8, 0, -10);

    headlights.push(leftLight, rightLight);
    // Farları başlangıçta kapalı tut veya aç
    headlights.forEach(h => { h.visible = false; scene.add(h); scene.add(h.target); });
}

function toggleLights() {
    headlights.forEach(h => h.visible = !h.visible);
}

function rotateCar() {
    isRotating = !isRotating;
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);
    controls.update();
    if(car && isRotating) car.rotation.y += 0.005;
    renderer.render(scene, camera);
}

init();
</script>
</body>
</html>
