<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GTA 7: Neo-Istanbul Stories</title>
    <style>
        body { margin: 0; background: #2c3e50; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; right: 20px; color: white; text-align: right; pointer-events: none; }
        #dialogue-box {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.85); color: #fff; padding: 20px; border-radius: 10px;
            border: 2px solid #f1c40f; display: none; width: 400px; text-align: center;
        }
        .controls { position: absolute; bottom: 20px; left: 20px; color: #ddd; font-size: 13px; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 5px; }
        b { color: #f1c40f; }
    </style>
</head>
<body>

<div id="ui">
    <div id="money" style="color: #2ecc71; font-size: 35px; font-weight: bold;">$0</div>
    <div id="wanted" style="color: #f1c40f; font-size: 30px; letter-spacing: 5px;"></div>
</div>

<div id="dialogue-box">
    <b id="npc-name">NPC:</b> <span id="npc-text">Merhaba!</span>
</div>

<div class="controls">
    <b>WASD:</b> Hareket | <b>E:</b> Arabaya Bin | <b>F:</b> Konuş | <b>SOL TIK:</b> Ateş Et | <b>R:</b> Reset
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x: 300, y: 300, rot: 0, inCar: false, score: 0, stars: 0 };
let car = { x: 500, y: 400, rot: 0, w: 80, h: 45, speed: 0 };
let npcs = [
    { x: 200, y: 200, name: "Esnaf Ahmet", msg: "Kardeşim dükkanın önünü kapama!", color: "#e67e22" },
    { x: 800, y: 500, name: "Sokak Serserisi", msg: "Ne bakıyon birader, işine bak.", color: "#95a5a6" },
    { x: 400, y: 100, name: "Polis Memuru", msg: "Ehliyet ve ruhsat lütfen...", color: "#2980b9" }
];
let keys = {};

window.addEventListener("keydown", e => keys[e.code] = true);
window.addEventListener("keyup", e => keys[e.code] = false);
window.addEventListener("keydown", e => {
    if(e.code === 'KeyF') interaction();
    if(e.code === 'KeyE') toggleCar();
});

function drawHuman(x, y, color, rot, isPlayer = false) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rot);
    
    // Gövde
    ctx.fillStyle = color;
    ctx.fillRect(-10, -15, 20, 30);
    // Kafa
    ctx.fillStyle = "#ffdbac";
    ctx.beginPath();
    ctx.arc(0, 0, 8, 0, Math.PI*2);
    ctx.fill();
    // Eller
    ctx.fillStyle = color;
    ctx.fillRect(-15, -5, 5, 10);
    ctx.fillRect(10, -5, 5, 10);
    
    if(isPlayer) { // Oyuncuya şapka takalım
        ctx.fillStyle = "#222";
        ctx.fillRect(-8, -10, 16, 5);
    }
    
    ctx.restore();
}

function drawCar(c) {
    ctx.save();
    ctx.translate(c.x, c.y);
    ctx.rotate(c.rot);
    
    // Tekerlekler
    ctx.fillStyle = "#111";
    ctx.fillRect(-35, -25, 15, 10); ctx.fillRect(20, -25, 15, 10);
    ctx.fillRect(-35, 15, 15, 10); ctx.fillRect(20, 15, 15, 10);
    
    // Kaporta
    ctx.fillStyle = "#f1c40f";
    ctx.fillRect(-40, -20, 80, 40);
    
    // Camlar
    ctx.fillStyle = "#34495e";
    ctx.fillRect(5, -15, 15, 30); // Ön cam
    ctx.fillRect(-30, -15, 10, 30); // Arka cam
    
    ctx.restore();
}

function interaction() {
    npcs.forEach(npc => {
        let dist = Math.hypot(player.x - npc.x, player.y - npc.y);
        if(dist < 50) {
            const box = document.getElementById("dialogue-box");
            document.getElementById("npc-name").innerText = npc.name;
            document.getElementById("npc-text").innerText = npc.msg;
            box.style.display = "block";
            setTimeout(() => { box.style.display = "none"; }, 3000);
        }
    });
}

function toggleCar() {
    let dist = Math.hypot(player.x - car.x, player.y - car.y);
    if (!player.inCar && dist < 60) {
        player.inCar = true;
        player.stars = Math.max(1, player.stars);
    } else if (player.inCar) {
        player.inCar = false;
        player.x = car.x + 60;
    }
}

function update() {
    let speed = player.inCar ? 7 : 3;
    let target = player.inCar ? car : player;

    if (keys['KeyW']) target.y -= speed;
    if (keys['KeyS']) target.y += speed;
    if (keys['KeyA']) target.x -= speed;
    if (keys['KeyD']) target.x += speed;

    // Yüzünü gittiği yöne dönme (Basit)
    if(keys['KeyD']) target.rot = 0;
    if(keys['KeyA']) target.rot = Math.PI;
    if(keys['KeyW']) target.rot = -Math.PI/2;
    if(keys['KeyS']) target.rot = Math.PI/2;

    if(player.inCar) { player.x = car.x; player.y = car.y; car.rot = player.rot; }

    document.getElementById("wanted").innerText = "★".repeat(player.stars);
}

function draw() {
    ctx.fillStyle = "#34495e"; // Asfalt rengi
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Basit yollar
    ctx.fillStyle = "#2c3e50";
    ctx.fillRect(0, 400, canvas.width, 150);

    drawCar(car);

    npcs.forEach(npc => {
        drawHuman(npc.x, npc.y, npc.color, 0);
        ctx.fillStyle = "white";
        ctx.font = "12px Arial";
        ctx.fillText(npc.name, npc.x - 20, npc.y - 30);
    });

    if(!player.inCar) {
        drawHuman(player.x, player.y, "#3498db", player.rot, true);
    }

    update();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
