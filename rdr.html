<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>RDR 2D: Halvior Frontier</title>
    <style>
        body { margin: 0; overflow: hidden; background: #3d2b1f; font-family: 'Georgia', serif; }
        #arayuz { position: absolute; top: 20px; left: 20px; color: #f4a460; background: rgba(30, 15, 0, 0.9); padding: 15px; border: 3px double #8b4513; border-radius: 5px; pointer-events: none; min-width: 250px; box-shadow: 5px 5px 15px #000; }
        #diyalog-kutusu { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 70%; background: rgba(0,0,0,0.85); color: #fff; padding: 25px; border-left: 10px solid #8b0000; display: none; text-align: center; font-size: 1.4em; border-radius: 5px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        #onur-bar { width: 100%; height: 12px; background: #444; margin-top: 8px; border: 1px solid #fff; position: relative; }
        #onur-imlec { width: 10px; height: 100%; background: #ffcc00; position: absolute; left: 50%; transition: 0.5s; }
        canvas { display: block; filter: sepia(0.3) contrast(1.1); }
    </style>
</head>
<body>

<div id="arayuz">
    <div style="font-size: 22px; font-weight: bold; color: #ffcc00; text-align: center;">ü§† HALVIOR VAH≈ûƒ∞ BATIDA</div>
    <hr>
    üí∞ Altƒ±n: $<span id="para">250.00</span><br>
    ‚ù§Ô∏è Saƒülƒ±k: <span id="can">100</span><br>
    ‚öñÔ∏è ONUR: <div id="onur-bar"><div id="onur-imlec"></div></div>
    ‚≠ê Aranƒ±yor: <span id="aranma" style="color: #0f0;">TEMƒ∞Z</span>
    <hr>
    <small style="color: #bbb;">WASD: Hareket | F: Selam/Racon | E: At Bin/ƒ∞n | Sol Click: Ate≈ü</small>
</div>

<div id="diyalog-kutusu"></div>

<canvas id="oyun"></canvas>

<script>
    const canvas = document.getElementById('oyun');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let oyuncu = { x: 1000, y: 1000, aci: 0, atUst√ºnde: false, can: 100, para: 250, onur: 50, aranma: 0 };
    let kamera = { x: 0, y: 0 };
    let mermiler = [];
    let tuslar = {};
    let fare = { x: 0, y: 0 };

    // --- GENƒ∞≈ûLETƒ∞LMƒ∞≈û Dƒ∞YALOG Sƒ∞STEMƒ∞ ---
    const diyaloglar = {
        dostca: ["G√ºnaydƒ±n yabancƒ±, buralarda yeni misin?", "Yolun a√ßƒ±k olsun evlat, atƒ±n da pek yakƒ±≈üƒ±klƒ±ymƒ±≈ü.", "≈ûerif bug√ºn huysuz, dikkat et de ba≈üƒ±n yanmasƒ±n."],
        kiskirtici: ["Neye bakƒ±yorsun? √ñmr√ºnde hi√ß kovboy g√∂rmedin mi?", "Buralarda senin gibileri pek sevmezler, yoluna git.", "O elindeki silahƒ± kƒ±lƒ±fƒ±na sok, yoksa ben sokarƒ±m."],
        at: ["Sakin ol kƒ±zƒ±m, sadece bir fƒ±rtƒ±na...", "Aferin sana, bizi yine kurtardƒ±n.", "Az kaldƒ±, kasabada sana en iyi yulafƒ± alacaƒüƒ±m."],
        dutch: ["Dutch: 'Bana g√ºven Arthur! Bir b√ºy√ºk i≈ü daha... Sonra Tahiti'de mango yiyeceƒüiz!'", "Halvior: 'Her seferinde aynƒ± ≈üeyi s√∂yl√ºyorsun ama hepimiz √∂l√ºyoruz!'"],
        serif: ["≈ûerif: 'Bu kasabada senin gibi haydutlara yer yok! Ya hapsi boylarsƒ±n ya da topraƒüƒ±!'"]
    };

    const binalar = [
        { x: 700, y: 600, w: 300, h: 400, isim: "SALOON", renk: "#4b2c20" },
        { x: 1300, y: 700, w: 200, h: 250, isim: "≈ûERƒ∞F", renk: "#3e2723" }
    ];

    let npcler = [
        { x: 1350, y: 800, isim: "≈ûerif", renk: "blue", tip: "serif" },
        { x: 850, y: 750, isim: "Dutch", renk: "red", tip: "dutch" },
        { x: 1100, y: 1400, isim: "Yabancƒ±", renk: "green", tip: "halk" }
    ];

    let at = { x: 1150, y: 1150 };

    window.onmousemove = (e) => { fare.x = e.clientX + kamera.x; fare.y = e.clientY + kamera.y; };
    window.onmousedown = () => { if(!oyuncu.atUst√ºnde) atesEt(); };
    window.onkeydown = (e) => { 
        tuslar[e.code] = true;
        if(e.code === 'KeyF') etkilesim();
        if(e.code === 'KeyE') atBinIn();
    };
    window.onkeyup = (e) => tuslar[e.code] = false;

    function atBinIn() {
        let d = Math.hypot(oyuncu.x - at.x, oyuncu.y - at.y);
        if(d < 70) {
            oyuncu.atUst√ºnde = !oyuncu.atUst√ºnde;
            if(!oyuncu.atUst√ºnde) diyalogGoster(diyaloglar.at[Math.floor(Math.random()*3)]);
        }
    }

    function atesEt() {
        let aci = Math.atan2(fare.y - oyuncu.y, fare.x - oyuncu.x);
        mermiler.push({ x: oyuncu.x, y: oyuncu.y, vx: Math.cos(aci)*20, vy: Math.sin(aci)*20 });
        diyalogGoster("Mezarƒ±nƒ± kazmaya ba≈üla, bu mermi adƒ±nƒ± ta≈üƒ±yor!");
    }

    function etkilesim() {
        let yakinNPC = npcler.find(n => Math.hypot(oyuncu.x - n.x, oyuncu.y - n.y) < 80);
        let mesaj = "";

        if(yakinNPC) {
            if(yakinNPC.tip === "dutch") mesaj = diyaloglar.dutch[Math.floor(Math.random()*2)];
            else if(yakinNPC.tip === "serif") mesaj = diyaloglar.serif[0];
            else {
                mesaj = oyuncu.onur > 40 ? diyaloglar.dostca[Math.floor(Math.random()*3)] : diyaloglar.kiskirtici[Math.floor(Math.random()*3)];
                oyuncu.onur += 2;
            }
        } else if(oyuncu.atUst√ºnde) {
            mesaj = diyaloglar.at[Math.floor(Math.random()*3)];
        } else {
            mesaj = "Halvior: 'Kimse yok mu kime racon kesek?'";
        }
        diyalogGoster(mesaj);
    }

    function diyalogGoster(metin) {
        const box = document.getElementById('diyalog-kutusu');
        box.innerText = metin;
        box.style.display = 'block';
        setTimeout(() => box.style.display = 'none', 3500);
    }

    function ciz() {
        ctx.setTransform(1,0,0,1,0,0);
        ctx.fillStyle = "#c2a385"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.translate(-kamera.x, -kamera.y);

        // Binalar ve √áevre
        binalar.forEach(b => {
            ctx.fillStyle = b.renk; ctx.fillRect(b.x, b.y, b.w, b.h);
            ctx.fillStyle = "yellow"; ctx.fillRect(b.x+20, b.y+50, 40, 40); // Pencere
            ctx.fillStyle = "#fff"; ctx.fillText(b.isim, b.x + b.w/2 - 20, b.y + 30);
        });

        // At
        ctx.fillStyle = "#6d4c41"; ctx.fillRect(at.x - 40, at.y - 20, 80, 40);
        ctx.fillStyle = "#000"; ctx.fillRect(at.x + 30, at.y - 15, 20, 15);

        // Karakterler
        npcler.forEach(n => {
            ctx.fillStyle = n.renk; ctx.fillRect(n.x - 15, n.y - 15, 30, 30);
            ctx.fillStyle = "#000"; ctx.fillRect(n.x - 20, n.y - 18, 40, 6); // ≈ûapka
            ctx.fillStyle = "#fff"; ctx.fillText(n.isim, n.x - 15, n.y - 25);
        });

        if(!oyuncu.atUst√ºnde) {
            ctx.save();
            ctx.translate(oyuncu.x, oyuncu.y);
            ctx.rotate(Math.atan2(fare.y - oyuncu.y, fare.x - oyuncu.x));
            ctx.fillStyle = "#2196f3"; ctx.fillRect(-15, -15, 30, 30);
            ctx.fillStyle = "#000"; ctx.fillRect(-20, -18, 40, 6);
            ctx.restore();
        } else {
            at.x = oyuncu.x; at.y = oyuncu.y;
        }

        // Mermiler
        mermiler.forEach((m, i) => {
            m.x += m.vx; m.y += m.vy;
            ctx.fillStyle = "yellow"; ctx.fillRect(m.x, m.y, 10, 3);
            npcler.forEach(n => {
                if(Math.hypot(m.x - n.x, m.y - n.y) < 30) {
                    oyuncu.onur -= 5;
                    oyuncu.aranma = 1;
                    mermiler.splice(i, 1);
                    diyalogGoster("VURULDU! Onur Kaybedildi!");
                }
            });
        });

        // G√ºncellemeler
        let hiz = oyuncu.atUst√ºnde ? 10 : 5;
        if(tuslar['KeyW']) oyuncu.y -= hiz;
        if(tuslar['KeyS']) oyuncu.y += hiz;
        if(tuslar['KeyA']) oyuncu.x -= hiz;
        if(tuslar['KeyD']) oyuncu.x += hiz;

        kamera.x = oyuncu.x - canvas.width/2;
        kamera.y = oyuncu.y - canvas.height/2;

        document.getElementById('onur-imlec').style.left = oyuncu.onur + "%";
        document.getElementById('para').innerText = oyuncu.para.toFixed(2);
        document.getElementById('aranma').innerText = oyuncu.aranma > 0 ? "‚≠êÔ∏è ARANIYOR ‚≠êÔ∏è" : "TEMƒ∞Z";
        document.getElementById('aranma').style.color = oyuncu.aranma > 0 ? "red" : "#0f0";

        requestAnimationFrame(ciz);
    }
    ciz();
</script>
</body>
</html>
