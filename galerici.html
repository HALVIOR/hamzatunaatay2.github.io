<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Tuna Galeri: Mafia & Drive</title>
    <style>
        :root { --neon: #00f2ff; --pink: #ff007f; --gold: #ffd700; --red: #ff4757; }
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* Dashboard */
        .hud { position: fixed; top: 0; width: 100%; padding: 20px; display: flex; justify-content: space-between; z-index: 100; pointer-events: none; }
        .stat-card { background: rgba(0,0,0,0.9); border: 1px solid var(--neon); padding: 10px 15px; border-radius: 5px; pointer-events: all; min-width: 120px; }

        .container { display: grid; grid-template-columns: 350px 1fr; height: 100vh; }
        
        /* Sol Men√º */
        .sidebar { background: #0a0a0a; border-right: 2px solid #222; padding: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 50; overflow-y: auto; }
        .npc-card { background: #111; border: 1px solid #333; padding: 15px; border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .npc-card:hover { border-color: var(--pink); background: #1a1a1a; }
        
        /* S√ºr√º≈ü Alanƒ± */
        .game-area { position: relative; background: #050505; }
        canvas { width: 100%; height: 100%; }

        /* Telefon */
        #phone { position: fixed; bottom: -400px; right: 40px; width: 200px; height: 350px; background: #151515; border: 4px solid #333; border-radius: 30px; transition: 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1000; padding: 20px; text-align: center; }
        #phone.ringing { bottom: 20px; border-color: var(--pink); box-shadow: 0 0 30px var(--pink); }

        /* Interaction Modal */
        #modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; border: 2px solid var(--gold); padding: 25px; border-radius: 15px; z-index: 2000; display: none; width: 300px; text-align: center; }
        .btn { background: #222; border: 1px solid var(--neon); color: #fff; padding: 10px; margin: 5px; cursor: pointer; width: 100%; border-radius: 5px; font-weight: bold; }
        .btn:hover { background: var(--neon); color: #000; }
    </style>
</head>
<body>

<div class="hud">
    <div style="display:flex; gap:10px;">
        <div class="stat-card">üí∞ <span id="cash">500,000</span>‚Ç∫</div>
        <div class="stat-card">üçî TOKLUK: %<span id="hunger">100</span></div>
        <div class="stat-card">üò´ STRES: %<span id="stress">0</span></div>
    </div>
    <div class="stat-card" style="border-color:var(--gold)">üèõÔ∏è BOR√á: <span id="debt">0</span>‚Ç∫</div>
</div>

<div class="container">
    <div class="sidebar">
        <h2 style="color:var(--neon); margin-top:0;">≈ûEHƒ∞R REHBERƒ∞</h2>
        <div id="npc-container"></div>
    </div>

    <div class="game-area">
        <canvas id="stage"></canvas>
        <div id="speedo" style="position:absolute; bottom:20px; left:20px; font-size:45px; color:var(--neon); font-family: monospace;">0 KM/H</div>
        
        <div id="modal">
            <h3 id="m-title" style="color:var(--gold)">NPC ADI</h3>
            <p id="m-text">Mesaj burada...</p>
            <div id="m-btns"></div>
            <button class="btn" style="border-color:var(--red)" onclick="closeModal()">KAPAT</button>
        </div>
    </div>
</div>

<div id="phone">
    <div style="color:#888; font-size:12px;">GELEN ARAMA</div>
    <h3 id="caller-name" style="color:var(--pink)">Bƒ∞Lƒ∞NMEYEN</h3>
    <div style="font-size:50px; margin:40px 0;">üì±</div>
    <p style="font-size:14px; animation: blink 1s infinite;">Cevaplamak i√ßin <b style="color:var(--neon)">[T]</b> tu≈üuna bas!</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // --- OYUN VERƒ∞LERƒ∞ ---
    let game = { money: 500000, hunger: 100, stress: 0, debt: 0, carColor: 0x00f2ff };
    const NPCs = [
        { name: "Tefeci Hayri", icon: "üï∂Ô∏è", msg: "Para lazƒ±m mƒ± yeƒüen? Faizimiz %50'dir.", type: "loan" },
        { name: "Baron Ziya", icon: "üö¨", msg: "≈ûehirde d√ºzeni ben saƒülarƒ±m. Arabana dikkat et.", type: "mafia" },
        { name: "Gurme Vedat", icon: "üç≤", msg: "D√ºnya fani, k√∂fte ≈üahane! Karnƒ±nƒ± doyur stresin gitsin.", type: "food" },
        { name: "Galerici Metin", icon: "üèéÔ∏è", msg: "Elimde temiz Supra var, takas d√º≈ü√ºn√ºr m√ºs√ºn?", type: "trade" },
        { name: "Modifiyeci Sabri", icon: "üîß", msg: "Basalƒ±m mƒ± bu makineyi usta?", type: "mod" }
    ];

    // --- UI Y√ñNETƒ∞Mƒ∞ ---
    const npcBox = document.getElementById('npc-container');
    NPCs.forEach(npc => {
        const el = document.createElement('div');
        el.className = 'npc-card';
        el.innerHTML = `<span style="font-size:20px">${npc.icon}</span> <b>${npc.name}</b>`;
        el.onclick = () => openModal(npc);
        npcBox.appendChild(el);
    });

    function openModal(npc) {
        document.getElementById('modal').style.display = 'block';
        document.getElementById('m-title').innerText = npc.name;
        document.getElementById('m-text').innerText = npc.msg;
        const btns = document.getElementById('m-btns');
        btns.innerHTML = "";

        if(npc.type === "loan") btn(btns, "100.000‚Ç∫ Bor√ß Al", () => { game.money += 100000; game.debt += 150000; updateHUD(); });
        if(npc.type === "food") btn(btns, "Yemek Ye (‚Ç∫5000)", () => { if(game.money>=5000){game.money-=5000; game.hunger=100; game.stress=0; updateHUD();} });
        if(npc.type === "mod") btn(btns, "Rengi Deƒüi≈ütir (‚Ç∫20k)", () => { if(game.money>=20000){game.money-=20000; game.carColor=Math.random()*0xffffff; buildCar(); updateHUD();} });
    }

    function btn(parent, text, fn) {
        const b = document.createElement('button'); b.className = 'btn'; b.innerText = text; b.onclick = fn; parent.appendChild(b);
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    function updateHUD() {
        document.getElementById('cash').innerText = game.money.toLocaleString();
        document.getElementById('hunger').innerText = Math.floor(game.hunger);
        document.getElementById('stress').innerText = Math.floor(game.stress);
        document.getElementById('debt').innerText = game.debt.toLocaleString();
    }

    // --- 3D MOTORU (A√áIK D√úNYA) ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, (window.innerWidth-350)/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('stage'), antialias: true });
    renderer.setSize(window.innerWidth - 350, window.innerHeight);

    // D√ºnya
    const grid = new THREE.GridHelper(1000, 50, 0x444444, 0x222222);
    scene.add(grid);
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));

    const player = new THREE.Group();
    scene.add(player);

    function buildCar() {
        player.clear();
        const body = new THREE.Mesh(new THREE.BoxGeometry(2, 0.8, 4), new THREE.MeshStandardMaterial({color: game.carColor}));
        body.position.y = 0.5;
        player.add(body);
        const l1 = new THREE.PointLight(0xffffff, 1, 10); l1.position.set(1,1,-2);
        const l2 = new THREE.PointLight(0xffffff, 1, 10); l2.position.set(-1,1,-2);
        player.add(l1, l2);
    }
    buildCar();

    camera.position.set(0, 10, 15);

    // --- KONTROLLER ---
    let keys = {};
    window.onkeydown = (e) => { 
        keys[e.key.toLowerCase()] = true; 
        if(e.key === 't') answerPhone();
    };
    window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

    let speed = 0, rot = 0;

    function gameLoop() {
        requestAnimationFrame(gameLoop);
        
        // S√ºr√º≈ü Fiziƒüi
        if(keys['w']) speed = Math.min(speed + 0.01, 1.2);
        else if(keys['s']) speed = Math.max(speed - 0.02, -0.4);
        else speed *= 0.98;

        if(keys['a']) rot += 0.04 * (speed > 0 ? 1 : -1);
        if(keys['d']) rot -= 0.04 * (speed > 0 ? 1 : -1);

        player.rotation.y = rot;
        player.translateZ(-speed);

        // Kamera Takibi
        const offset = new THREE.Vector3(0, 8, 15).applyMatrix4(player.matrixWorld);
        camera.position.lerp(offset, 0.1);
        camera.lookAt(player.position);

        // ƒ∞statistik Azalmasƒ±
        game.hunger = Math.max(0, game.hunger - 0.005);
        if(game.hunger < 30) game.stress = Math.min(100, game.stress + 0.01);
        
        document.getElementById('speedo').innerText = Math.abs(Math.floor(speed * 150)) + " KM/H";
        updateHUD();
        renderer.render(scene, camera);
    }

    // --- TELEFON Sƒ∞STEMƒ∞ ---
    function ringPhone() {
        const p = document.getElementById('phone');
        const caller = ["Tefeci Hayri", "Baron Ziya", "Bilinmeyen Numara"][Math.floor(Math.random()*3)];
        document.getElementById('caller-name').innerText = caller;
        p.classList.add('ringing');
        setTimeout(() => p.classList.remove('ringing'), 7000);
    }

    function answerPhone() {
        const p = document.getElementById('phone');
        if(p.classList.contains('ringing')) {
            p.classList.remove('ringing');
            alert(document.getElementById('caller-name').innerText + ": Alo? Borcun g√ºn√º ge√ßiyor, dikkat et!");
        }
    }

    setInterval(ringPhone, 25000);
    gameLoop();
</script>
</body>
</html>
